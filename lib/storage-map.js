"use strict";function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj;}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;},_typeof(obj);}require("core-js/modules/es.symbol.js");require("core-js/modules/es.symbol.description.js");require("core-js/modules/es.symbol.iterator.js");require("core-js/modules/es.array.from.js");require("core-js/modules/es.array.slice.js");require("core-js/modules/es.regexp.to-string.js");require("core-js/modules/es.function.name.js");require("core-js/modules/es.regexp.exec.js");require("core-js/modules/es.symbol.to-primitive.js");require("core-js/modules/es.date.to-primitive.js");require("core-js/modules/es.object.keys.js");require("core-js/modules/es.object.get-own-property-descriptor.js");require("core-js/modules/es.object.get-own-property-descriptors.js");Object.defineProperty(exports,"__esModule",{value:true});exports.hasComparator=exports.hasCachedAt=exports.hasCacheFor=exports.getCachedAt=exports.getCacheFor=exports.filterStoreArray=exports.filterStore=exports.filterStorageArray=exports.filterStorage=exports.filterSoftStorageArray=exports.filterSoftStorage=exports.filterMetaFor=exports.filterHardStorageArray=exports.filterHardStorage=exports.filterFor=exports.filterFetchArray=exports.filterFetch=exports.filterClear=exports.default=exports.createMeta=exports.createIsSoftStorage=exports.createIsHardStorage=exports.createComparator=exports.createCachedAt=exports.createCacheFor=exports.createAccessedAt=void 0;exports.initialise=initialise;exports.initialiseFetch=initialiseFetch;exports.initialiseFetchHardStorage=initialiseFetchHardStorage;exports.initialiseFetchMap=initialiseFetchMap;exports.initialiseFetchMetaMap=initialiseFetchMetaMap;exports.initialiseFetchSoftStorage=initialiseFetchSoftStorage;exports.initialiseFetchStorage=initialiseFetchStorage;exports.initialiseStore=initialiseStore;exports.initialiseStoreHardStorage=initialiseStoreHardStorage;exports.initialiseStoreMap=initialiseStoreMap;exports.initialiseStoreMetaMap=initialiseStoreMetaMap;exports.initialiseStoreSoftStorage=initialiseStoreSoftStorage;exports.initialiseStoreStorage=initialiseStoreStorage;exports.reduceStoreMetaArray=exports.reduceStoreMeta=exports.reduceStoreArray=exports.reduceStore=exports.reduceFetchMetaArray=exports.reduceFetchMeta=exports.reduceFetchArray=exports.reduceFetch=exports.putIntoStoreMetaMap=exports.putIntoStoreMap=exports.putIntoFetchMetaMap=exports.putIntoFetchMap=exports.notCachedAt=exports.notCacheFor=exports.min=exports.max=exports.mapType=exports.mapMetaType=exports.mapCachedAt=exports.mapCacheFor=exports.isStale=exports.isSoftStorage=exports.isHardStorage=exports.isEqual=void 0;require("core-js/modules/es.number.constructor.js");require("core-js/modules/es.array.includes.js");require("core-js/modules/es.string.includes.js");require("core-js/modules/es.array.map.js");require("core-js/modules/es.array.filter.js");require("core-js/modules/es.object.to-string.js");require("core-js/modules/es.array.concat.js");require("core-js/modules/es.array.iterator.js");require("core-js/modules/es.map.js");require("core-js/modules/es.string.iterator.js");require("core-js/modules/web.dom-collections.iterator.js");require("core-js/modules/es.set.js");require("core-js/modules/web.dom-collections.for-each.js");var _actions=require("./actions");var _excluded=["comparator"],_excluded2=["accessedAt"],_excluded3=["cachedAt"],_excluded4=["cacheFor"],_excluded5=["type"],_excluded6=["type"];function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return _typeof(key)==="symbol"?key:String(key);}function _toPrimitive(input,hint){if(_typeof(input)!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(_typeof(res)!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return(hint==="string"?String:Number)(input);}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter);}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2;}var min=function min(){var values=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return Math.min.apply(Math,_toConsumableArray(values));};exports.min=min;var max=function max(){var values=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return Math.max.apply(Math,_toConsumableArray(values));};exports.max=max;var isStale=function isStale(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$cachedAt=_ref.cachedAt,cachedAt=_ref$cachedAt===void 0?0:_ref$cachedAt,_ref$cacheFor=_ref.cacheFor,cacheFor=_ref$cacheFor===void 0?0:_ref$cacheFor;return cachedAt+cacheFor<Date.now();};exports.isStale=isStale;var isEqual=function isEqual(){var alpha=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var omega=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return getCachedAt(alpha)===getCachedAt(omega)&&getCacheFor(alpha)===getCacheFor(omega);};exports.isEqual=isEqual;var isHardStorage=function isHardStorage(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref2$cacheFor=_ref2.cacheFor,cacheFor=_ref2$cacheFor===void 0?0:_ref2$cacheFor;return cacheFor>=1000*60*60*24;};exports.isHardStorage=isHardStorage;var isSoftStorage=function isSoftStorage(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref3$cacheFor=_ref3.cacheFor,cacheFor=_ref3$cacheFor===void 0?0:_ref3$cacheFor;return cacheFor>=1000*60*60&&cacheFor<1000*60*60*24;};exports.isSoftStorage=isSoftStorage;var hasComparator=function hasComparator(){var _ref4=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref4$comparator=_ref4.comparator,comparator=_ref4$comparator===void 0?null:_ref4$comparator;return comparator instanceof Function;};exports.hasComparator=hasComparator;var filterFor=function filterFor(t){return function(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},type=_ref5.type;return type===t;};};exports.filterFor=filterFor;var filterMetaFor=function filterMetaFor(t){return function(){var _ref6=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref6$meta=_ref6.meta,_ref6$meta2=_ref6$meta===void 0?{}:_ref6$meta,type=_ref6$meta2.type;return type===t;};};exports.filterMetaFor=filterMetaFor;var mapType=function mapType(){var _ref7=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref7$type=_ref7.type,type=_ref7$type===void 0?null:_ref7$type;return type;};exports.mapType=mapType;var mapMetaType=function mapMetaType(){var _ref8=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref8$meta=_ref8.meta,_ref8$meta2=_ref8$meta===void 0?{}:_ref8$meta,_ref8$meta2$type=_ref8$meta2.type,type=_ref8$meta2$type===void 0?null:_ref8$meta2$type;return type;};exports.mapMetaType=mapMetaType;var mapCacheFor=function mapCacheFor(){var _ref9=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref9$meta=_ref9.meta,_ref9$meta2=_ref9$meta===void 0?{}:_ref9$meta,_ref9$meta2$cacheFor=_ref9$meta2.cacheFor,cacheFor=_ref9$meta2$cacheFor===void 0?0:_ref9$meta2$cacheFor;return cacheFor;};exports.mapCacheFor=mapCacheFor;var mapCachedAt=function mapCachedAt(){var _ref10=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref10$meta=_ref10.meta,_ref10$meta2=_ref10$meta===void 0?{}:_ref10$meta,_ref10$meta2$cachedAt=_ref10$meta2.cachedAt,cachedAt=_ref10$meta2$cachedAt===void 0?0:_ref10$meta2$cachedAt;return cachedAt;};exports.mapCachedAt=mapCachedAt;var createIsHardStorage=function createIsHardStorage(meta){return _objectSpread(_objectSpread({},meta),isHardStorage(meta)?{isHardStorage:true}:{});};exports.createIsHardStorage=createIsHardStorage;var createIsSoftStorage=function createIsSoftStorage(meta){return _objectSpread(_objectSpread({},meta),isSoftStorage(meta)?{isSoftStorage:true}:{});};exports.createIsSoftStorage=createIsSoftStorage;var createComparator=function createComparator(){var _ref11=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref11$comparator=_ref11.comparator,comparator=_ref11$comparator===void 0?null:_ref11$comparator,meta=_objectWithoutProperties(_ref11,_excluded);return _objectSpread(_objectSpread({},meta),comparator?{comparator:comparator}:{});};exports.createComparator=createComparator;var createAccessedAt=function createAccessedAt(){var _ref12=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref12$accessedAt=_ref12.accessedAt,accessedAt=_ref12$accessedAt===void 0?null:_ref12$accessedAt,meta=_objectWithoutProperties(_ref12,_excluded2);return _objectSpread(_objectSpread({},meta),accessedAt?{accessedAt:accessedAt}:{});};exports.createAccessedAt=createAccessedAt;var createCachedAt=function createCachedAt(){var _ref13=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref13$cachedAt=_ref13.cachedAt,cachedAt=_ref13$cachedAt===void 0?null:_ref13$cachedAt,meta=_objectWithoutProperties(_ref13,_excluded3);return _objectSpread(_objectSpread({},meta),cachedAt?{cachedAt:cachedAt}:{});};exports.createCachedAt=createCachedAt;var createCacheFor=function createCacheFor(){var _ref14=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref14$cacheFor=_ref14.cacheFor,cacheFor=_ref14$cacheFor===void 0?null:_ref14$cacheFor,meta=_objectWithoutProperties(_ref14,_excluded4);return _objectSpread(_objectSpread({},meta),cacheFor?{cacheFor:cacheFor}:{});};exports.createCacheFor=createCacheFor;var createMeta=function createMeta(){var meta=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return createIsHardStorage(createIsSoftStorage(createCacheFor(createCachedAt(createAccessedAt(meta)))));};exports.createMeta=createMeta;var hasCachedAt=function hasCachedAt(){var _ref15=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref15$cachedAt=_ref15.cachedAt,cachedAt=_ref15$cachedAt===void 0?0:_ref15$cachedAt;return Math.floor(Number(cachedAt))>0;};exports.hasCachedAt=hasCachedAt;var hasCacheFor=function hasCacheFor(){var _ref16=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref16$cacheFor=_ref16.cacheFor,cacheFor=_ref16$cacheFor===void 0?0:_ref16$cacheFor;return Math.floor(Number(cacheFor))>0;};exports.hasCacheFor=hasCacheFor;var notCachedAt=function notCachedAt(){var _ref17=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref17$cachedAt=_ref17.cachedAt,cachedAt=_ref17$cachedAt===void 0?0:_ref17$cachedAt;return isNaN(Number(cachedAt))||Math.floor(Number(cachedAt))<1;};exports.notCachedAt=notCachedAt;var notCacheFor=function notCacheFor(){var _ref18=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref18$cacheFor=_ref18.cacheFor,cacheFor=_ref18$cacheFor===void 0?0:_ref18$cacheFor;return isNaN(Number(cacheFor))||Math.floor(Number(cacheFor))<1;};exports.notCacheFor=notCacheFor;var filterFetch=function filterFetch(){var _ref19=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref19$meta=_ref19.meta,meta=_ref19$meta===void 0?{}:_ref19$meta;return hasCacheFor(meta);};exports.filterFetch=filterFetch;var filterStore=function filterStore(){var _ref20=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref20$meta=_ref20.meta,meta=_ref20$meta===void 0?{}:_ref20$meta;return hasCacheFor(meta);};exports.filterStore=filterStore;var filterClear=function filterClear(){var _ref21=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref21$meta=_ref21.meta,meta=_ref21$meta===void 0?{}:_ref21$meta;return notCacheFor(meta);};exports.filterClear=filterClear;var getCachedAt=function getCachedAt(){var _ref22=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref22$cachedAt=_ref22.cachedAt,cachedAt=_ref22$cachedAt===void 0?0:_ref22$cachedAt;return cachedAt;};exports.getCachedAt=getCachedAt;var getCacheFor=function getCacheFor(){var _ref23=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref23$cacheFor=_ref23.cacheFor,cacheFor=_ref23$cacheFor===void 0?0:_ref23$cacheFor;return cacheFor;};exports.getCacheFor=getCacheFor;var reduceFetch=function reduceFetch(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var _ref24=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref24.type,meta=_ref24.meta,_ref24$meta=_ref24.meta,_ref24$meta2=_ref24$meta===void 0?{}:_ref24$meta,_ref24$meta2$cacheFor=_ref24$meta2.cacheFor,cacheFor=_ref24$meta2$cacheFor===void 0?0:_ref24$meta2$cacheFor,t=_ref24$meta2.type;var index=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var array=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];return a.map(mapType).includes(type)?a:min(array.filter(filterFor(type)).map(mapCacheFor))!==cacheFor?a:a.concat(_objectSpread({type:type},meta?{meta:{cacheFor:cacheFor}}:{}));};exports.reduceFetch=reduceFetch;var reduceFetchMeta=function reduceFetchMeta(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var _ref25=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref25.type,meta=_ref25.meta,_ref25$meta=_ref25.meta,_ref25$meta2=_ref25$meta===void 0?{}:_ref25$meta,_ref25$meta2$cacheFor=_ref25$meta2.cacheFor,cacheFor=_ref25$meta2$cacheFor===void 0?0:_ref25$meta2$cacheFor,t=_ref25$meta2.type;var index=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var array=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];return a.filter(filterFor(type)).map(mapMetaType).includes(t)?a:min(array.filter(filterFor(type)).filter(filterMetaFor(t)).map(mapCacheFor))!==cacheFor?a:a.concat(_objectSpread({type:type},meta?{meta:meta}:{}));};exports.reduceFetchMeta=reduceFetchMeta;var reduceStore=function reduceStore(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var _ref26=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref26.type,meta=_ref26.meta,_ref26$meta=_ref26.meta,_ref26$meta2=_ref26$meta===void 0?{}:_ref26$meta,_ref26$meta2$cacheFor=_ref26$meta2.cacheFor,cacheFor=_ref26$meta2$cacheFor===void 0?0:_ref26$meta2$cacheFor,t=_ref26$meta2.type;var index=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var array=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];return a.filter(filterFor(type)).map(mapMetaType).includes(t)?a:min(array.filter(filterMetaFor(t)).map(mapCacheFor))!==cacheFor?a:a.concat(_objectSpread({type:type},meta?{meta:meta}:{}));};exports.reduceStore=reduceStore;var reduceStoreMeta=function reduceStoreMeta(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var _ref27=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref27.type,meta=_ref27.meta,_ref27$meta=_ref27.meta,_ref27$meta2=_ref27$meta===void 0?{}:_ref27$meta,_ref27$meta2$cacheFor=_ref27$meta2.cacheFor,cacheFor=_ref27$meta2$cacheFor===void 0?0:_ref27$meta2$cacheFor,t=_ref27$meta2.type;var index=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var array=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];return a.filter(filterFor(type)).map(mapMetaType).includes(t)?a:min(array.filter(filterFor(type)).filter(filterMetaFor(t)).map(mapCacheFor))!==cacheFor?a:a.concat(_objectSpread({type:type},meta?{meta:meta}:{}));};exports.reduceStoreMeta=reduceStoreMeta;var filterHardStorage=function filterHardStorage(){var _ref28=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},meta=_ref28.meta;return isHardStorage(meta);};exports.filterHardStorage=filterHardStorage;var filterSoftStorage=function filterSoftStorage(){var _ref29=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},meta=_ref29.meta;return isSoftStorage(meta);};exports.filterSoftStorage=filterSoftStorage;var filterStorage=function filterStorage(){var _ref30=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},meta=_ref30.meta;return!(isHardStorage(meta)||isSoftStorage(meta));};exports.filterStorage=filterStorage;var putIntoFetchMap=function putIntoFetchMap(){var _ref31=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref31$fetchMap=_ref31.fetchMap,fetchMap=_ref31$fetchMap===void 0?new Map():_ref31$fetchMap;var _ref32=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref32.type,_ref32$meta=_ref32.meta,meta=_ref32$meta===void 0?{}:_ref32$meta;fetchMap.set(type,_objectSpread(_objectSpread({},meta),{},{type:type}));};exports.putIntoFetchMap=putIntoFetchMap;var putIntoFetchMetaMap=function putIntoFetchMetaMap(){var _ref33=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref33$fetchMetaMap=_ref33.fetchMetaMap,fetchMetaMap=_ref33$fetchMetaMap===void 0?new Map():_ref33$fetchMetaMap;var _ref34=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref34.type,_ref34$meta=_ref34.meta,meta=_ref34$meta===void 0?{}:_ref34$meta;var fetchMetaSet=fetchMetaMap.get(type)||new Set();fetchMetaMap.set(type,fetchMetaSet.add(meta));};exports.putIntoFetchMetaMap=putIntoFetchMetaMap;var putIntoStoreMap=function putIntoStoreMap(){var _ref35=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref35$storeMap=_ref35.storeMap,storeMap=_ref35$storeMap===void 0?new Map():_ref35$storeMap;var _ref36=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref36.type,_ref36$meta=_ref36.meta,_ref36$meta2=_ref36$meta===void 0?{}:_ref36$meta,TYPE=_ref36$meta2.type,meta=_objectWithoutProperties(_ref36$meta2,_excluded5);var storeSet=storeMap.get(TYPE)||new Set();storeMap.set(TYPE,storeSet.add(_objectSpread(_objectSpread({},meta),{},{type:type})));};exports.putIntoStoreMap=putIntoStoreMap;var putIntoStoreMetaMap=function putIntoStoreMetaMap(){var _ref37=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref37$storeMetaMap=_ref37.storeMetaMap,storeMetaMap=_ref37$storeMetaMap===void 0?new Map():_ref37$storeMetaMap;var _ref38=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref38$meta=_ref38.meta,_ref38$meta2=_ref38$meta===void 0?{}:_ref38$meta,type=_ref38$meta2.type,cacheFor=_ref38$meta2.cacheFor;storeMetaMap.set(type,{type:type,cacheFor:cacheFor});};exports.putIntoStoreMetaMap=putIntoStoreMetaMap;var filterHardStorageArray=function filterHardStorageArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(filterHardStorage);};exports.filterHardStorageArray=filterHardStorageArray;var filterSoftStorageArray=function filterSoftStorageArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(filterSoftStorage);};exports.filterSoftStorageArray=filterSoftStorageArray;var filterStorageArray=function filterStorageArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(filterStorage);};exports.filterStorageArray=filterStorageArray;var filterFetchArray=function filterFetchArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(filterFetch);};exports.filterFetchArray=filterFetchArray;var filterStoreArray=function filterStoreArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(filterStore);};exports.filterStoreArray=filterStoreArray;var reduceFetchArray=function reduceFetchArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.reduce(reduceFetch,[]);};exports.reduceFetchArray=reduceFetchArray;var reduceStoreArray=function reduceStoreArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.reduce(reduceStore,[]);};exports.reduceStoreArray=reduceStoreArray;var reduceFetchMetaArray=function reduceFetchMetaArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.reduce(reduceFetchMeta,[]);};exports.reduceFetchMetaArray=reduceFetchMetaArray;var reduceStoreMetaArray=function reduceStoreMetaArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.reduce(reduceStoreMeta,[]);};exports.reduceStoreMetaArray=reduceStoreMetaArray;function initialiseFetchMap(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};array.forEach(function(configuration){putIntoFetchMap(params,configuration);});}function initialiseFetchMetaMap(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};array.forEach(function(configuration){putIntoFetchMetaMap(params,configuration);});}function initialiseStoreMap(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};array.forEach(function(configuration){putIntoStoreMap(params,configuration);});}function initialiseStoreMetaMap(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};array.forEach(function(configuration){putIntoStoreMetaMap(params,configuration);});}function initialiseFetchHardStorage(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var fetchArray=filterHardStorageArray(array);initialiseFetchMap(reduceFetchArray(fetchArray),params);initialiseFetchMetaMap(reduceFetchMetaArray(fetchArray),params);}function initialiseFetchSoftStorage(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var fetchArray=filterSoftStorageArray(array);initialiseFetchMap(reduceFetchArray(fetchArray),params);initialiseFetchMetaMap(reduceFetchMetaArray(fetchArray),params);}function initialiseFetchStorage(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var fetchArray=filterStorageArray(array);initialiseFetchMap(reduceFetchArray(fetchArray),params);initialiseFetchMetaMap(reduceFetchMetaArray(fetchArray),params);}function initialiseFetch(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var fetchArray=filterFetchArray(array);initialiseFetchHardStorage(fetchArray,params);initialiseFetchSoftStorage(fetchArray,params);initialiseFetchStorage(fetchArray,params);}function initialiseStoreHardStorage(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var storeArray=filterHardStorageArray(array);initialiseStoreMap(reduceStoreArray(storeArray),params);initialiseStoreMetaMap(reduceStoreMetaArray(storeArray),params);}function initialiseStoreSoftStorage(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var storeArray=filterSoftStorageArray(array);initialiseStoreMap(reduceStoreArray(storeArray),params);initialiseStoreMetaMap(reduceStoreMetaArray(storeArray),params);}function initialiseStoreStorage(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var storeArray=filterStorageArray(array);initialiseStoreMap(reduceStoreArray(storeArray),params);initialiseStoreMetaMap(reduceStoreMetaArray(storeArray),params);}function initialiseStore(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var storeArray=filterStoreArray(array);initialiseStoreHardStorage(storeArray,params);initialiseStoreSoftStorage(storeArray,params);initialiseStoreStorage(storeArray,params);}function initialise(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};initialiseFetch(array,params);initialiseStore(array,params);}var HASOWNPROPERTY=Object.prototype.hasOwnProperty;var getReduxStorage=function getReduxStorage(){var _ref39=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref39$reduxStorage=_ref39.reduxStorage,reduxStorage=_ref39$reduxStorage===void 0?{}:_ref39$reduxStorage;return reduxStorage;};var getStateFromStore=function getStateFromStore(store){return getReduxStorage(store.getState());};var getStateForActionType=function getStateForActionType(type){var _ref40=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref40$type=_ref40[type],state=_ref40$type===void 0?{}:_ref40$type;return state;};var hasStateForActionType=function hasStateForActionType(type){var state=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return HASOWNPROPERTY.call(state,type);};var _default=function _default(array){var configuration=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(Array.isArray(array)){var _configuration$fetchM=configuration.fetchMap,fetchMap=_configuration$fetchM===void 0?new Map():_configuration$fetchM,_configuration$storeM=configuration.storeMap,storeMap=_configuration$storeM===void 0?new Map():_configuration$storeM,_configuration$fetchM2=configuration.fetchMetaMap,fetchMetaMap=_configuration$fetchM2===void 0?new Map():_configuration$fetchM2,_configuration$storeM2=configuration.storeMetaMap,storeMetaMap=_configuration$storeM2===void 0?new Map():_configuration$storeM2,_configuration$clearM=configuration.clearMap,clearMap=_configuration$clearM===void 0?new Map():_configuration$clearM;initialise(array,{fetchMap:fetchMap,storeMap:storeMap,fetchMetaMap:fetchMetaMap,storeMetaMap:storeMetaMap,clearMap:clearMap});return function(store){return function(next){return function(){var _ref41=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},type=_ref41.type,action=_objectWithoutProperties(_ref41,_excluded6);if(fetchMap.has(type)){var accessedAt=Date.now();var state=getStateFromStore(store);var _getStateForActionTyp=getStateForActionType(type,state),_getStateForActionTyp2=_getStateForActionTyp.meta,_getStateForActionTyp3=_getStateForActionTyp2===void 0?fetchMap.get(type):_getStateForActionTyp2,cacheFor=_getStateForActionTyp3.cacheFor,cachedAt=_getStateForActionTyp3.cachedAt;if(isStale({cacheFor:cacheFor,cachedAt:cachedAt})){var META=createMeta({type:type,cacheFor:cacheFor,cachedAt:accessedAt,accessedAt:accessedAt});store.dispatch((0,_actions.storageWriteAction)(META,_objectSpread(_objectSpread({},action),{},{type:type})));if(fetchMetaMap.has(type)){var fetchMetaSet=fetchMetaMap.get(type);fetchMetaSet.forEach(function(_ref42){var type=_ref42.type;if(hasStateForActionType(type,state)){var _getStateForActionTyp4=getStateForActionType(type,state),_getStateForActionTyp5=_getStateForActionTyp4.meta,_getStateForActionTyp6=_getStateForActionTyp5===void 0?{}:_getStateForActionTyp5,_cacheFor=_getStateForActionTyp6.cacheFor,_cachedAt=_getStateForActionTyp6.cachedAt,data=_getStateForActionTyp4.data;var _META=createMeta({type:type,cacheFor:_cacheFor,cachedAt:_cachedAt,accessedAt:accessedAt});store.dispatch((0,_actions.storageClearAction)(_META,data));}});}return next(_objectSpread(_objectSpread({},action),{},{type:type}));}else{var _META2=createMeta({type:type,cacheFor:cacheFor,cachedAt:cachedAt,accessedAt:accessedAt});store.dispatch((0,_actions.storageFetchAction)(_META2,_objectSpread(_objectSpread({},action),{},{type:type})));if(fetchMetaMap.has(type)){var _fetchMetaSet=fetchMetaMap.get(type);_fetchMetaSet.forEach(function(_ref43){var type=_ref43.type;if(hasStateForActionType(type,state)){var _getStateForActionTyp7=getStateForActionType(type,state),_getStateForActionTyp8=_getStateForActionTyp7.meta,_getStateForActionTyp9=_getStateForActionTyp8===void 0?{}:_getStateForActionTyp8,_cacheFor2=_getStateForActionTyp9.cacheFor,_cachedAt2=_getStateForActionTyp9.cachedAt,data=_getStateForActionTyp7.data;var _META3=createMeta({type:type,cacheFor:_cacheFor2,cachedAt:_cachedAt2,accessedAt:accessedAt});store.dispatch((0,_actions.storageFetchAction)(_META3,data));if(data)store.dispatch(data);}});}return _objectSpread(_objectSpread({},action),{},{type:type});}}else{if(storeMap.has(type)){var _accessedAt=Date.now();var _state=getStateFromStore(store);var storeSet=storeMap.get(type);storeSet.forEach(function(_ref44){var type=_ref44.type,cacheFor=_ref44.cacheFor;if(hasStateForActionType(type,_state)){var _getStateForActionTyp10=getStateForActionType(type,_state),_getStateForActionTyp11=_getStateForActionTyp10.meta,_cacheFor3=_getStateForActionTyp11.cacheFor,_cachedAt3=_getStateForActionTyp11.cachedAt,data=_getStateForActionTyp10.data;var _META4=createMeta({type:type,cacheFor:_cacheFor3,cachedAt:_cachedAt3,accessedAt:_accessedAt});store.dispatch((0,_actions.storageStoreAction)(_META4,data));}});if(storeMetaMap.has(type)){var _getStateForActionTyp12=getStateForActionType(type,_state),_getStateForActionTyp13=_getStateForActionTyp12.meta,_getStateForActionTyp14=_getStateForActionTyp13===void 0?storeMetaMap.get(type):_getStateForActionTyp13,_cacheFor4=_getStateForActionTyp14.cacheFor,_getStateForActionTyp15=_getStateForActionTyp14.cachedAt,_cachedAt4=_getStateForActionTyp15===void 0?_accessedAt:_getStateForActionTyp15;var _META5=createMeta({type:type,cacheFor:_cacheFor4,cachedAt:_cachedAt4,accessedAt:_accessedAt});store.dispatch((0,_actions.storageStoreAction)(_META5,_objectSpread(_objectSpread({},action),{},{type:type})));}return next(_objectSpread(_objectSpread({},action),{},{type:type}));}}return next(_objectSpread(_objectSpread({},action),{},{type:type}));};};};}return function(){return function(next){return function(action){return next(action);};};};};exports.default=_default;
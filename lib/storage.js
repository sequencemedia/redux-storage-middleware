"use strict";require("core-js/modules/es.object.keys.js");require("core-js/modules/es.symbol.js");require("core-js/modules/es.array.filter.js");require("core-js/modules/es.object.to-string.js");require("core-js/modules/es.object.get-own-property-descriptor.js");require("core-js/modules/web.dom-collections.for-each.js");require("core-js/modules/es.object.get-own-property-descriptors.js");Object.defineProperty(exports,"__esModule",{value:true});exports.mergeMeta=exports.mergeData=exports.fromStringToObject=exports.fromObjectToString=exports.default=exports.createMeta=exports.createCachedAt=exports.createCacheFor=exports.createAccessedAt=void 0;var _actions=require("./actions");var _hardStorage=_interopRequireDefault(require("./components/storage/hard-storage"));var _softStorage=_interopRequireDefault(require("./components/storage/soft-storage"));var _excluded=["cachedAt"],_excluded2=["cacheFor"],_excluded3=["accessedAt"],_excluded4=["isHardStorage","isSoftStorage","type"],_excluded5=["isHardStorage","isSoftStorage","type"];function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}var hardStorage=(0,_hardStorage.default)();var softStorage=(0,_softStorage.default)();var fromObjectToString=function fromObjectToString(object){return JSON.stringify(object);};exports.fromObjectToString=fromObjectToString;var fromStringToObject=function fromStringToObject(string){return JSON.parse(string);};exports.fromStringToObject=fromStringToObject;var createCachedAt=function createCachedAt(_ref){var _ref$cachedAt=_ref.cachedAt,cachedAt=_ref$cachedAt===void 0?0:_ref$cachedAt,meta=_objectWithoutProperties(_ref,_excluded);return _objectSpread(_objectSpread({},meta),cachedAt?{cachedAt:cachedAt}:{});};exports.createCachedAt=createCachedAt;var createCacheFor=function createCacheFor(_ref2){var _ref2$cacheFor=_ref2.cacheFor,cacheFor=_ref2$cacheFor===void 0?0:_ref2$cacheFor,meta=_objectWithoutProperties(_ref2,_excluded2);return _objectSpread(_objectSpread({},meta),cacheFor?{cacheFor:cacheFor}:{});};exports.createCacheFor=createCacheFor;var createAccessedAt=function createAccessedAt(_ref3){var _ref3$accessedAt=_ref3.accessedAt,accessedAt=_ref3$accessedAt===void 0?false:_ref3$accessedAt,meta=_objectWithoutProperties(_ref3,_excluded3);return _objectSpread(_objectSpread({},meta),accessedAt?{accessedAt:accessedAt}:{});};exports.createAccessedAt=createAccessedAt;var createMeta=function createMeta(){var _ref4=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref4$cachedAt=_ref4.cachedAt,cachedAt=_ref4$cachedAt===void 0?0:_ref4$cachedAt,_ref4$cacheFor=_ref4.cacheFor,cacheFor=_ref4$cacheFor===void 0?0:_ref4$cacheFor,_ref4$accessedAt=_ref4.accessedAt,accessedAt=_ref4$accessedAt===void 0?0:_ref4$accessedAt;return createCachedAt(createCacheFor(createAccessedAt({cachedAt:cachedAt,cacheFor:cacheFor,accessedAt:accessedAt})));};exports.createMeta=createMeta;var mergeMeta=function mergeMeta(alpha,omega){return{meta:_objectSpread(_objectSpread({},alpha||{}),omega||{})};};exports.mergeMeta=mergeMeta;var mergeData=function mergeData(alpha,omega){return _objectSpread({},alpha?{data:_objectSpread(_objectSpread({},alpha),omega||{})}:omega?{data:omega}:{});};exports.mergeData=mergeData;var getReduxStorage=function getReduxStorage(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref5$reduxStorage=_ref5.reduxStorage,reduxStorage=_ref5$reduxStorage===void 0?{}:_ref5$reduxStorage;return reduxStorage;};var getStateFromStore=function getStateFromStore(store){return getReduxStorage(store.getState());};var getStateForActionType=function getStateForActionType(type){var _ref6=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref6$type=_ref6[type],state=_ref6$type===void 0?{}:_ref6$type;return state;};function storageWrite(store,_ref7){var _ref7$meta=_ref7.meta;_ref7$meta=_ref7$meta===void 0?{}:_ref7$meta;var _ref7$meta$isHardStor=_ref7$meta.isHardStorage,isHardStorage=_ref7$meta$isHardStor===void 0?false:_ref7$meta$isHardStor,_ref7$meta$isSoftStor=_ref7$meta.isSoftStorage,isSoftStorage=_ref7$meta$isSoftStor===void 0?false:_ref7$meta$isSoftStor,type=_ref7$meta.type,meta=_objectWithoutProperties(_ref7$meta,_excluded4),data=_ref7.data;if(isHardStorage){var _getStateForActionTyp=getStateForActionType(type,getStateFromStore(store)),_getStateForActionTyp2=_getStateForActionTyp.meta,stateMeta=_getStateForActionTyp2===void 0?{}:_getStateForActionTyp2,stateData=_getStateForActionTyp.data;var ITEM=fromObjectToString(_objectSpread({meta:createMeta(_objectSpread(_objectSpread({},stateMeta),meta))},stateData?{data:_objectSpread(_objectSpread({},stateData),data||{})}:data?{data:data}:{}));hardStorage.setItem(type,ITEM);}else{if(isSoftStorage){var _getStateForActionTyp3=getStateForActionType(type,getStateFromStore(store)),_getStateForActionTyp4=_getStateForActionTyp3.meta,_stateMeta=_getStateForActionTyp4===void 0?{}:_getStateForActionTyp4,_stateData=_getStateForActionTyp3.data;var _ITEM=fromObjectToString(_objectSpread({meta:createMeta(_objectSpread(_objectSpread({},_stateMeta),meta))},_stateData?{data:_objectSpread(_objectSpread({},_stateData),data||{})}:data?{data:data}:{}));softStorage.setItem(type,_ITEM);}}}function storageClear(store,_ref8){var _ref8$meta=_ref8.meta;_ref8$meta=_ref8$meta===void 0?{}:_ref8$meta;var _ref8$meta$isHardStor=_ref8$meta.isHardStorage,isHardStorage=_ref8$meta$isHardStor===void 0?false:_ref8$meta$isHardStor,_ref8$meta$isSoftStor=_ref8$meta.isSoftStorage,isSoftStorage=_ref8$meta$isSoftStor===void 0?false:_ref8$meta$isSoftStor,type=_ref8$meta.type,meta=_objectWithoutProperties(_ref8$meta,_excluded5);if(isHardStorage){hardStorage.removeItem(type);}else{if(isSoftStorage){softStorage.removeItem(type);}}}var _default=function _default(store){return function(next){return function(action){var type=action.type;switch(type){case _actions.STORAGE_FETCH:storageWrite(store,action);return next(action);case _actions.STORAGE_STORE:storageWrite(store,action);return next(action);case _actions.STORAGE_WRITE:storageWrite(store,action);return next(action);case _actions.STORAGE_CLEAR:storageClear(store,action);return next(action);default:return next(action);}};};};exports.default=_default;